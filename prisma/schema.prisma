// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//datasource db {
//  provider = "sqlite"
//  url      = "file:./dev.db"
//}

model Product {
  id              Int              @id @default(autoincrement())
  name            String
  description     String
  price           Decimal
  stock           Int
  ProductInvoices InvoiceProduct[]
}

model Service {
  id              Int              @id @default(autoincrement())
  name            String
  duration        Int
  price           Decimal
  Appointment     Appointment[]
  ServiceInvoices InvoiceService[]
}

model Customer {
  id           Int           @id @default(autoincrement())
  firstname    String
  lastname     String
  email        String
  phone        Int
  Appointments Appointment[]
  Bills        Bill[]
  Ticket       Ticket[]
}

model Staff {
  id               Int               @id @default(autoincrement())
  firstname        String
  lastname         String
  email            String
  phone            Int
  Appointments     Appointment[]
  Bills            Bill[]
  CashTransactions CashTransaction[]
  Tickets          Ticket[]
}

model Appointment {
  id Int @id @default(autoincrement())

  staffId Int
  staff   Staff @relation(fields: [staffId], references: [id])

  customerId Int
  customer   Customer @relation(fields: [customerId], references: [id])

  serviceId Int
  service   Service @relation(fields: [serviceId], references: [id])

  time     DateTime
  duration Int // Minutes
  status   Status   @default(PENDIND) // Enum not supported in sqlite (handle in api)
}

model Bill {
  id Int @id @default(autoincrement())

  staffId Int
  staff   Staff @relation(fields: [staffId], references: [id])

  customerId Int
  customer   Customer @relation(fields: [customerId], references: [id])

  billnumber  Int
  TotalAmount Decimal @default(0.0)
  TotalPaid   Decimal @default(0.0)

  invoiceDate DateTime @default(now()) @db.Date

  createdAt DateTime @default(now())

  InvoiceServices  InvoiceService[]
  InvoiceProducts  InvoiceProduct[]
  CashTransactions CashTransaction[]
  Payment          Payment[]
  Ticket           Ticket[]
}

model InvoiceService {
  id Int @id @default(autoincrement())

  billId Int
  bill   Bill @relation(fields: [billId], references: [id])

  serviceId Int
  service   Service @relation(fields: [serviceId], references: [id])

  price Decimal

  duration         Int
  CashTransactions CashTransaction[]

  Tickets Ticket[]
}

model InvoiceProduct {
  id Int @id @default(autoincrement())

  billId Int
  bill   Bill @relation(fields: [billId], references: [id])

  productId Int
  product   Product @relation(fields: [productId], references: [id])

  price Decimal

  quantity         Int
  CashTransactions CashTransaction[]

  Ticket Ticket[]
}

enum Status {
  PENDIND
  ACCEPTING
  FINISHING
}

// ... (Votre mod√®le Prisma existant)

model CashTransaction {
  id Int @id @default(autoincrement())

  staffId Int
  staff   Staff @relation(fields: [staffId], references: [id])

  amount           Decimal
  type             TransactionType
  createdAt        DateTime        @default(now())
  billId           Int
  bill             Bill            @relation(fields: [billId], references: [id])
  invoiceproductId Int
  invoiceproduct   InvoiceProduct  @relation(fields: [invoiceproductId], references: [id])
  invoiceserviceId Int
  invoiceservice   InvoiceService  @relation(fields: [invoiceserviceId], references: [id])
}

model Payment {
  id Int @id @default(autoincrement())

  amount        Decimal
  paymentMethod PaymentMethod
  createdAt     DateTime      @default(now())

  billId Int
  bill   Bill @relation(fields: [billId], references: [id])
}

model Ticket {
  id Int @id @default(autoincrement())

  staffId Int
  staff   Staff @relation(fields: [staffId], references: [id])

  customerId Int
  customer   Customer @relation(fields: [customerId], references: [id])

  status           TicketStatus
  createdAt        DateTime       @default(now())
  billId           Int
  bill             Bill           @relation(fields: [billId], references: [id])
  invoiceproductId Int
  invoiceproduct   InvoiceProduct @relation(fields: [invoiceproductId], references: [id])
  invoiceserviceId Int
  invoiceservice   InvoiceService @relation(fields: [invoiceserviceId], references: [id])
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum PaymentMethod {
  CASH
  CARD
  ONLINE
}

enum TicketStatus {
  OPEN
  SUSPENDED
  CLOSED
}
